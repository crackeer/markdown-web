<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>代码创建</title>
    <script src="/framework.js"></script>


<body></body>
<template id="template">

    <div class="row g-3 align-items-center" style="margin-top: 7px;">
        <label for="title" class="col-form-label col-sm-1 text-end">标题</label>
        <div class="col-sm-6">
            <input type="text" class="form-control" placeholder="请输入标题" v-model="title">
        </div>
        <div class="col-auto">
            <button class="btn btn-primary" @click="createCode">提交</button>
        </div>
    </div>
    <div class="row g-3 align-items-center" style="margin-top: 0px;margin-bottom: 10px;">
        <label for="category" class="col-form-label col-sm-1 text-end">语言</label>
        <div class="col-sm-6">
            <div class="btn-group btn-group-sm" role="group">
                <template v-for="(item, i) in languageList">
                        <input class="btn-check" type="radio" name="language" :value="item" v-model="language"
                            @change="changeLanguage()" :id="'radio-' + item" />
                        <label class="btn btn-outline-primary" :for="'radio-' + item">{{item}}</label>
                </template>
            </div>
        </div>
    </div>

    <div id="container"></div>
</template>

<script>
    window.VueObject = {
        data() {
            let list = []
            return {
                content: '',
                title: '',
                language: '',
                languageList: [],

            }
        },
        template: '#template',
        async mounted() {
            await this.getLanguageList()
            let language = getQuery('language', 'go')
            this.language = language;
            setTimeout(() => {
                initCodeEditor("container", language, "")
            }, 400)
        },
        methods: {
            async getLanguageList() {
                let result = await axios.get('/code/language')
                this.languageList = result.data.data || []
            },
            changeLanguage() {
                monaco.editor.setModelLanguage(codeEditor.getModel(), this.language);
            },
            async createCode() {
                let data = {
                    title: this.title,
                    content: window.codeEditor.getValue(),
                    language: this.language,
                }
                console.log(data)
                if (data.title.trim().length < 1) {
                    bootbox.alert('请输入标题')
                    return
                }
                if (this.language.trim().length < 1) {
                    bootbox.alert('请选择分类')
                    return
                }
                let result = await axios.post('/create/code', data)
                if (result.data.code != 0) {
                    bootbox.alert(result.data.message)
                    return
                }
                jump('/code/detail.html', {
                    'id': result.data.data.id,
                })

            }
        }
    }
</script>

</html>